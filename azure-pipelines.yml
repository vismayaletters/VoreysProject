# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  batch: "true"
  branches:
    include:
      - master
      - dev
  paths:
    exclude:
      - README.md
      - azure-pipelines.yml
pr:
  autoCancel: "true"
  branches:
    include:
      - master
      - dev
  paths:
    exclude:
      - README.md
jobs:
- job: Deploy
  variables:
  - ${{ if eq(variables['build.SourceBranchName'], 'dev') }}:
    - group: sfdx-org-dev
    - name: TaskId
      value:  ' `echo "$(Build.SourceVersionMessage)" | head -n1 | cut -d " " -f1`'
  - ${{ if eq(variables['build.SourceBranchName'], 'master') }}:
    - group: sfdx-org-master
    - name: MyVar
      value:  ' `echo "$(Build.SourceVersionMessage)" | head -c 5`'
    - name: TaskId
      value:  " "
  steps:
    - script: echo $(SalesforceUserName)
    - script: echo $(InstanceUrl)
    - script: echo $(Clientid)
    - script: echo $(Build.SourceVersionMessage)
    - script: echo $(MyVar)
    - script: echo $(TaskId)
    - task: Bash@3
      inputs:
            targetType: 'inline'
            script: |
                firstWord=' `echo "$(Build.SourceVersionMessage)" | head -n1 | cut -d " " -f1`'
                echo "##vso[task.setvariable variable=TaskId]$firstWord"
      displayName: "Assigning firstWord to TaskId"
    - task: Bash@3
      inputs:
            targetType: 'inline'
            script: |
                echo $(TaskId)
      displayName: "Checking the new value of TaskId"
    - task: UseNode@1
    - bash: 
    - script: curl -u vismayaletters@gmail.com:$(JiraApiToken) -X PUT --data '{"update":{"comment":[{"add":{"body":{"type":"doc","version":1,"content":[{"type":"paragraph","content":[{"text":"UPdated by pippeline","type":"text"}]}]}}} ]} }' -H "Content-Type:application/json" https://vismayaletters.atlassian.net/rest/api/3/issue/$TaskId
      condition: startsWith(variables['Build.SourceVersionMessage'], 'VOR')